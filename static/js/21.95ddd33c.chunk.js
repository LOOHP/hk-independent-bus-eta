"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[21],{8747:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(8310),a=r(1660),s=r(7313),o=r(4511),l=r(4395),i=r(6060),u=r(3135);var c=r(6417);const d=e=>{let{stops:t,isFocus:r}=e;const d=(e=>{let{stopKeys:t,disabled:r=!1}=e;const{db:{routeList:n,stopList:a,serviceDayMap:c},isVisible:d,refreshInterval:p,isRouteFilter:h,isTodayHoliday:g}=(0,s.useContext)(i.ZP),b=(0,s.useMemo)((()=>t.reduce(((e,t)=>{let[r]=t;return"lightRail"===r}),!1)),[t]),x=(0,s.useMemo)((()=>Object.entries(n).reduce(((e,r)=>{let[n,{stops:a,freq:s}]=r;return h&&!(0,u.x4)(n,s,g,c)||t.forEach((t=>{var r;let[s,o]=t;null===(r=a[s])||void 0===r||r.forEach(((t,r)=>{t===o&&e.push([n,r])}))})),e}),[]).map((e=>e.join("|"))).filter(((e,t,r)=>r.indexOf(e)===t)).map((e=>e.split("|")))),[t,n,h,g,c]),[m,f]=(0,s.useState)([]),{i18n:{language:v}}=(0,o.$)(),k=(0,s.useRef)(!1),C=(0,s.useCallback)((()=>!d||r||"prerendering"===navigator.userAgent?(f([]),new Promise((e=>e([])))):Promise.all(x.map((e=>{let[t,r]=e;return(0,l.Gx)({...n[t],seq:parseInt(r,10),stopList:a,language:v})}))).then((e=>{k.current&&f(e.map(((e,t)=>[x[t].join("/"),e.filter((e=>{let{co:r,dest:a}=e;return"mtr"!==r||a.zh===n[x[t][0]].dest.zh}))])).sort(((e,t)=>{let[r,n]=e,[a,s]=t;return 0===n.length?1:0===s.length?-1:b?n[0].remark.zh===s[0].remark.zh?n[0].eta<s[0].eta?-1:1:n[0].remark.zh<s[0].remark.zh?-1:1:n[0].eta===s[0].eta?r<a?-1:1:n[0].eta<s[0].eta?-1:1})))}))),[d,r,v,n,a,x,b]);return(0,s.useEffect)((()=>{k.current=!0;const e=setInterval((()=>{C()}),p);return C(),()=>{k.current=!1,clearInterval(e)}}),[C,p]),m})({stopKeys:t,disabled:!r});return(0,c.jsx)(n.Z,{children:d.map((e=>{let[t,r]=e;return(0,c.jsx)(a.Z,{routeId:t,etas:r},t)}))})}},5439:(e,t,r)=>{r.d(t,{Z:()=>u});r(7313);var n=r(501),a=r(1113),s=r(4511),o=r(2286),l=r(7822),i=r(6417);const u=()=>{const{t:e}=(0,s.$)(),t=(0,o.GE)();return"prerendering"!==navigator.userAgent&&t&&(t.WTCSGNL&&c.includes(t.WTCSGNL.code)||t.WRAIN&&d.includes(t.WRAIN.code))?(0,i.jsxs)(n.Z,{variant:"outlined",sx:p,onClick:()=>window.open(e("bad-weather-link"),"_target"),children:[(0,i.jsx)(l.Z,{color:"error"}),(0,i.jsx)(a.Z,{children:e("bad-weather-text")})]}):null},c=["TC8NE","TC8SE","TC8NW","TC8SW","TC9","TC10"],d=["WARINR","WRAINB"],p={borderRadius:e=>e.shape.borderRadius,cursor:"pointer",px:2,py:1,display:"flex",alignItems:"center",textAlign:"left",gap:1}},9004:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(7313),a=r(3428),s=r(4183),o=r(3405),l=r(1113),i=r(4511),u=r(6060),c=r(6417);const d=()=>{const{t:e}=(0,i.$)(),{db:{updateTime:t},renewDb:r}=(0,n.useContext)(u.ZP),d=(0,n.useMemo)((()=>Date.now()>t+24192e5),[t]);return"prerendering"!==navigator.userAgent&&d?(0,c.jsx)(a.Z,{variant:"outlined",sx:p,onClick:r,children:(0,c.jsx)(s.Z,{children:(0,c.jsx)(o.Z,{children:(0,c.jsx)(l.Z,{children:e("db-renew-text")})})})}):null},p={borderRadius:e=>e.shape.borderRadius,margin:.2,height:"100%",display:"flex"}},6021:(e,t,r)=>{r.r(t),r.d(t,{default:()=>v});var n=r(7313),a=r(6060),s=r(501),o=r(7829),l=r(5439),i=r(9004),u=r(1113),c=r(8485),d=r(5280),p=r(4511),h=r(6417);const g=e=>{let{stopTab:t,onChangeTab:r}=e;const{t:s,i18n:{language:o}}=(0,p.$)(),{db:{stopList:l},savedStops:i}=(0,n.useContext)(a.ZP);return 0===i.length?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(u.Z,{variant:"h6",children:s("\u672a\u6709\u6536\u85cf\u8eca\u7ad9")}),(0,h.jsx)(u.Z,{variant:"body1",children:s("\u8acb\u6309\u4e0b\u5716\u6307\u793a\u589e\u52a0")})]}):(0,h.jsx)(c.Z,{value:t,onChange:(e,t)=>r(t,!0),sx:b,variant:"scrollable",scrollButtons:!0,children:i.map((e=>e.split("|"))).filter((e=>{let[t,r]=e;return l[r]})).map(((e,t)=>{let[r,n]=e;return(0,h.jsx)(d.Z,{label:l[n].name[o],value:"".concat(r,"|").concat(n),disableRipple:!0},"stops-".concat(n))}))})},b={background:e=>e.palette.background.default,minHeight:"36px","& .MuiTab-root":{alignItems:"center",justifyContent:"center",paddingTop:0,paddingBottom:0,minHeight:"32px","&.Mui-selected":{color:e=>"dark"===e.palette.mode?e.palette.primary.main:"black"}},"& .MuiTabs-flexContainer":{justifyContent:"flex-start"},"& .MuiTabs-indicator":{backgroundColor:e=>"dark"===e.palette.mode?e.palette.primary.main:"black"}};var x=r(2547),m=r(8747);const f=n.forwardRef(((e,t)=>{let{stopTab:r,onChangeTab:s}=e;const{db:{stopList:o,stopMap:l},savedStops:i}=(0,n.useContext)(a.ZP),u=(0,n.useRef)(r);(0,n.useImperativeHandle)(t,(()=>({changeTab:e=>{u.current=e}})));const c=(0,n.useMemo)((()=>i.filter((e=>e.split("|")[1]in o))),[i,o]),d=(0,n.useCallback)((()=>{let e=c.indexOf(u.current);return-1!==e?e:-1}),[c]),p=(0,n.useMemo)((()=>c.map((e=>{var t;if(""===e)return[];const r=[e.split("|")];return null===(t=l[r[0][1]])||void 0===t||t.forEach((e=>r.push(e))),r}))),[c,l]);return(0,h.jsx)(x.ZP,{index:d(),onChangeIndex:e=>{s(c[e])},children:p.map(((e,t)=>(0,h.jsx)(m.Z,{stops:e,isFocus:d()===t},"savedStops-".concat(t))))})})),v=()=>{const{savedStops:e,db:{stopList:t},colorMode:r}=(0,n.useContext)(a.ZP),{i18n:{language:u}}=(0,p.$)(),c=(0,n.useRef)(null),d=(0,n.useMemo)((()=>{try{var r;const n=null!==(r=localStorage.getItem("stopTab"))&&void 0!==r?r:"|";if(n&&e.includes(n)&&t[n.split("|")[1]])return n;for(let r=0;r<e.length;++r){let n=e[r].split("|")[1];if(t[n])return e[r]}}catch(n){console.error(n)}return""}),[e,t]),[b,x]=(0,n.useState)(d),m=(0,n.useCallback)((e=>""===b?"unset":"dark"===e.palette.mode?e.palette.background.default:"white"),[b]);(0,n.useEffect)((()=>{localStorage.setItem("stopTab",b)}),[b]);const v=(0,n.useCallback)((e=>{var t;x(e),null===(t=c.current)||void 0===t||t.changeTab(e)}),[]);return(0,h.jsxs)(s.Z,{sx:{...k,bgcolor:m,backgroundImage:""===b?"url(/img/stop-bookmark-guide-".concat(r,"-").concat(u,".png)"):"unset",opacity:""===b?"0.8":"unset"},square:!0,elevation:0,children:[(0,h.jsx)(g,{stopTab:b,onChangeTab:v}),(0,h.jsx)(l.Z,{}),(0,h.jsx)(i.Z,{}),(0,h.jsx)(o.Z,{sx:{flex:1,overflow:"scroll"},children:(0,h.jsx)(f,{ref:c,stopTab:b,onChangeTab:e=>x(e)})})]})},k={textAlign:"center",display:"flex",flexDirection:"column",overflow:"auto",width:"100%",flex:1,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"}},7822:(e,t,r)=>{var n=r(4836);t.Z=void 0;var a=n(r(5045)),s=r(6417),o=(0,a.default)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");t.Z=o}}]);